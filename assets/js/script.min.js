let allData=[],filteredData=[],currentPage=1;const itemsPerPage=20;let charts={},reverseRatioChart=!1,reversePositionChart=!1,reverseNV1Chart=!1,reverseNV2Chart=!1,reverseMajorChart=!1,reverseGenderMajorChart=!1,reverseNV1vs2Chart=!1,reverseTopPairsChart=!1,reverseAgeChart=!1;function init(){allData=candidateData,filteredData=allData,updateStats(),populatePositions(),populateNV1(),populateNV2(),displayTable(),setTimeout(drawCharts,100)}function switchTab(t){document.querySelectorAll(".tab-content").forEach((t=>{t.classList.remove("active")})),document.querySelectorAll(".tab-button").forEach((t=>{t.classList.remove("active")})),document.getElementById(t).classList.add("active"),event.target.classList.add("active"),"dashboard"===t&&setTimeout(updateCharts,100)}function updateStats(){const t=allData.length,e=allData.filter((t=>"Nam"===t["Giới tính"])).length,a=allData.filter((t=>"Nữ"===t["Giới tính"])).length;document.getElementById("totalCount").textContent=t.toLocaleString("vi-VN"),document.getElementById("maleCount").textContent=e.toLocaleString("vi-VN"),document.getElementById("femaleCount").textContent=a.toLocaleString("vi-VN"),document.getElementById("resultCount").textContent=filteredData.length.toLocaleString("vi-VN")}function populatePositions(){const t=[...new Set(allData.map((t=>t["Vị trí dự tuyển"])).filter((t=>t)))];t.sort().reverse();const e=document.getElementById("positionFilter");t.forEach((t=>{const a=document.createElement("option");a.value=t,a.textContent=t,e.appendChild(a)}))}function populateNV1(){const t=[...new Set(allData.map((t=>t["Tên trường NV1"])).filter((t=>t&&t.trim())))];t.sort().reverse();const e=document.getElementById("nv1Filter");t.forEach((t=>{const a=document.createElement("option");a.value=t,a.textContent=t,e.appendChild(a)}))}function populateNV2(){const t=[...new Set(allData.map((t=>t["Tên Trường NV2"])).filter((t=>t&&t.trim())))];t.sort().reverse();const e=document.getElementById("nv2Filter");t.forEach((t=>{const a=document.createElement("option");a.value=t,a.textContent=t,e.appendChild(a)}))}function getChartColors(t){const e=["#FF6384","#36A2EB","#FFCE56","#4BC0C0","#9966FF","#FF9F40","#FF6384","#C9CBCF","#4BC0C0","#FF9F40"],a=[];for(let n=0;n<t;n++)a.push(e[n%e.length]);return a}function drawCharts(){const t={};allData.forEach((e=>{const a=e["Vị trí dự tuyển"];a&&(t[a]=(t[a]||0)+1)}));const e=Object.keys(t).sort(((e,a)=>t[a]-t[e])),a=e.map((e=>t[e]));if(document.getElementById("positionChart")){const t=Math.max(400,25*e.length);document.getElementById("positionChart").style.height=t+"px",drawPositionChart()}if(document.getElementById("ratioChart")){const t=allData.length,n=a.map((e=>(e/t*100).toFixed(1))),r=Math.max(400,25*e.length);document.getElementById("ratioChart").style.height=r+"px",drawRatioChart(e,a,n,r)}document.getElementById("nv1Chart")&&drawNV1Chart(),document.getElementById("nv2Chart")&&drawNV2Chart();const n={Nam:allData.filter((t=>"Nam"===t["Giới tính"])).length,"Nữ":allData.filter((t=>"Nữ"===t["Giới tính"])).length};if(document.getElementById("genderChart")){const t=document.getElementById("genderChart").getContext("2d");charts.genderChart=new Chart(t,{type:"pie",data:{labels:["Nam","Nữ"],datasets:[{data:[n.Nam,n["Nữ"]],backgroundColor:["#add8e6","#ffc0cb"]}]},options:{responsive:!0,plugins:{legend:{position:"bottom"}}}})}const r={};if(e.forEach((t=>{const e=allData.filter((e=>e["Vị trí dự tuyển"]===t&&"Nam"===e["Giới tính"])).length,a=allData.filter((e=>e["Vị trí dự tuyển"]===t&&"Nữ"===e["Giới tính"])).length;r[t]={nam:e,nu:a}})),document.getElementById("genderPositionChart")){const t=Math.max(400,25*e.length),a=document.getElementById("genderPositionChart");a.style.height=t+"px";const n=a.getContext("2d");charts.genderPositionChart=new Chart(n,{type:"bar",data:{labels:e,datasets:[{label:"Nam",data:e.map((t=>r[t].nam)),backgroundColor:"#add8e6"},{label:"Nữ",data:e.map((t=>r[t].nu)),backgroundColor:"#ffc0cb"}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,scales:{x:{stacked:!0,beginAtZero:!0},y:{stacked:!0,ticks:{font:{size:11}}}}}})}document.getElementById("majorChart")&&drawMajorChart(),document.getElementById("genderMajorChart")&&drawGenderMajorChart(),document.getElementById("nv1vs2Chart")&&drawNV1vs2Chart(),document.getElementById("topPairsChart")&&drawTopPairsChart(),document.getElementById("ageChart")&&drawAgeChart(),document.getElementById("noteChart")&&drawNoteChart()}function updateCharts(){Object.values(charts).forEach((t=>{t&&t.destroy&&t.destroy()})),charts={},drawCharts()}function toggleRatioChart(){reverseRatioChart=!reverseRatioChart,charts.ratioChart&&charts.ratioChart.destroy&&charts.ratioChart.destroy(),drawRatioChart()}function togglePositionChart(){reversePositionChart=!reversePositionChart,charts.positionChart&&charts.positionChart.destroy&&charts.positionChart.destroy(),drawPositionChart()}function toggleNV1Chart(){reverseNV1Chart=!reverseNV1Chart,charts.nv1Chart&&charts.nv1Chart.destroy&&charts.nv1Chart.destroy(),drawNV1Chart()}function toggleNV2Chart(){reverseNV2Chart=!reverseNV2Chart,charts.nv2Chart&&charts.nv2Chart.destroy&&charts.nv2Chart.destroy(),drawNV2Chart()}function toggleMajorChart(){reverseMajorChart=!reverseMajorChart,charts.majorChart&&charts.majorChart.destroy&&charts.majorChart.destroy(),drawMajorChart()}function toggleGenderMajorChart(){reverseGenderMajorChart=!reverseGenderMajorChart,charts.genderMajorChart&&charts.genderMajorChart.destroy&&charts.genderMajorChart.destroy(),drawGenderMajorChart()}function toggleNV1vs2Chart(){reverseNV1vs2Chart=!reverseNV1vs2Chart,charts.nv1vs2Chart&&charts.nv1vs2Chart.destroy&&charts.nv1vs2Chart.destroy(),drawNV1vs2Chart()}function toggleTopPairsChart(){reverseTopPairsChart=!reverseTopPairsChart,charts.topPairsChart&&charts.topPairsChart.destroy&&charts.topPairsChart.destroy(),drawTopPairsChart()}function toggleAgeChart(){reverseAgeChart=!reverseAgeChart,charts.ageChart&&charts.ageChart.destroy&&charts.ageChart.destroy(),drawAgeChart()}function drawRatioChart(t,e,a,n){const r={};allData.forEach((t=>{const e=t["Vị trí dự tuyển"];e&&(r[e]=(r[e]||0)+1)}));let o=Object.keys(r).sort(((t,e)=>r[e]-r[t])),s=o.map((t=>(r[t]/allData.length*100).toFixed(1)));reverseRatioChart&&(o=o.reverse(),s=s.reverse());const i=document.getElementById("ratioChart"),l=Math.max(400,25*o.length);i.style.height=l+"px";const d=i.getContext("2d");charts.ratioChart=new Chart(d,{type:"bar",data:{labels:o,datasets:[{label:"Tỷ Lệ (%)",data:s,backgroundColor:getChartColors(o.length),borderRadius:5}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{beginAtZero:!0,max:100},y:{ticks:{font:{size:11}}}}}})}function drawPositionChart(){const t={};allData.forEach((e=>{const a=e["Vị trí dự tuyển"];a&&(t[a]=(t[a]||0)+1)}));let e=Object.keys(t).sort(((e,a)=>t[a]-t[e])),a=e.map((e=>t[e]));reversePositionChart&&(e=e.reverse(),a=a.reverse());const n=document.getElementById("positionChart"),r=Math.max(400,25*e.length);n.style.height=r+"px";const o=n.getContext("2d");charts.positionChart=new Chart(o,{type:"bar",data:{labels:e,datasets:[{label:"Số Ứng Viên",data:a,backgroundColor:getChartColors(e.length),borderRadius:5}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{beginAtZero:!0},y:{ticks:{font:{size:11}}}}}})}function drawNV1Chart(){const t={};allData.forEach((e=>{const a=e["Tên trường NV1"];if(a&&a.trim()){const e=a.trim();t[e]=(t[e]||0)+1}}));let e=Object.keys(t).sort(((e,a)=>t[a]-t[e])),a=e.map((e=>t[e]));reverseNV1Chart&&(e=e.reverse(),a=a.reverse());const n=document.getElementById("nv1Chart"),r=Math.max(400,25*e.length);n.style.height=r+"px";const o=n.getContext("2d");charts.nv1Chart=new Chart(o,{type:"bar",data:{labels:e,datasets:[{label:"Số NV1",data:a,backgroundColor:getChartColors(e.length),borderRadius:5}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{beginAtZero:!0},y:{ticks:{font:{size:11}}}}}})}function drawNV2Chart(){const t={};allData.forEach((e=>{const a=e["Tên Trường NV2"];if(a&&a.trim()){const e=a.trim();t[e]=(t[e]||0)+1}}));let e=Object.keys(t).sort(((e,a)=>t[a]-t[e])),a=e.map((e=>t[e]));reverseNV2Chart&&(e=e.reverse(),a=a.reverse());const n=document.getElementById("nv2Chart"),r=Math.max(400,25*e.length);n.style.height=r+"px";const o=n.getContext("2d");charts.nv2Chart=new Chart(o,{type:"bar",data:{labels:e,datasets:[{label:"Số NV2",data:a,backgroundColor:getChartColors(e.length),borderRadius:5}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{beginAtZero:!0},y:{ticks:{font:{size:11}}}}}})}function drawMajorChart(){const t={};allData.forEach((e=>{const a=e["Chuyên ngành đào tạo"];if(a&&a.trim()){const e=a.trim();t[e]=(t[e]||0)+1}}));let e=Object.keys(t).sort(((e,a)=>t[a]-t[e])),a=e.map((e=>t[e]));reverseMajorChart&&(e=e.reverse(),a=a.reverse());const n=document.getElementById("majorChart"),r=Math.max(400,30*e.length);n.style.height=r+"px",n.style.minHeight=r+"px";const o=n.getContext("2d");charts.majorChart=new Chart(o,{type:"bar",data:{labels:e,datasets:[{label:"Số Ứng Viên",data:a,backgroundColor:getChartColors(e.length),borderRadius:5}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{beginAtZero:!0},y:{ticks:{font:{size:11}}}}}})}function drawGenderMajorChart(){const t={};allData.forEach((e=>{const a=e["Chuyên ngành đào tạo"];if(a&&a.trim()){const n=a.trim();t[n]||(t[n]={nam:0,nu:0}),"Nam"===e["Giới tính"]?t[n].nam++:"Nữ"===e["Giới tính"]&&t[n].nu++}}));let e=Object.keys(t).sort(((e,a)=>t[a].nam+t[a].nu-(t[e].nam+t[e].nu)));reverseGenderMajorChart&&(e=e.reverse());const a=document.getElementById("genderMajorChart"),n=Math.max(400,30*e.length);a.style.height=n+"px",a.style.minHeight=n+"px";const r=a.getContext("2d");charts.genderMajorChart=new Chart(r,{type:"bar",data:{labels:e,datasets:[{label:"Nam",data:e.map((e=>t[e].nam)),backgroundColor:"#add8e6"},{label:"Nữ",data:e.map((e=>t[e].nu)),backgroundColor:"#ffc0cb"}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,scales:{x:{stacked:!0,beginAtZero:!0},y:{stacked:!0,ticks:{font:{size:11}}}}}})}function drawNV1vs2Chart(){const t={};allData.forEach((e=>{const a=e["Vị trí dự tuyển"];a&&(t[a]||(t[a]={nv1:0,nv2:0}),e["Tên trường NV1"]&&e["Tên trường NV1"].trim()&&t[a].nv1++,e["Tên Trường NV2"]&&e["Tên Trường NV2"].trim()&&t[a].nv2++)}));let e=Object.keys(t).sort(((e,a)=>t[a].nv1+t[a].nv2-(t[e].nv1+t[e].nv2)));reverseNV1vs2Chart&&(e=e.reverse());const a=document.getElementById("nv1vs2Chart"),n=Math.max(400,30*e.length);a.style.height=n+"px",a.style.minHeight=n+"px";const r=a.getContext("2d");charts.nv1vs2Chart=new Chart(r,{type:"bar",data:{labels:e,datasets:[{label:"Nguyện Vọng 1",data:e.map((e=>t[e].nv1)),backgroundColor:"#36A2EB"},{label:"Nguyện Vọng 2",data:e.map((e=>t[e].nv2)),backgroundColor:"#FF9F40"}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,scales:{x:{beginAtZero:!0},y:{ticks:{font:{size:11}}}}}})}function drawTopPairsChart(){const t={};allData.forEach((e=>{const a=e["Vị trí dự tuyển"],n=e["Tên trường NV1"];if(a&&n&&n.trim()){const e=a+" → "+n;t[e]=(t[e]||0)+1}}));let e=Object.keys(t).sort(((e,a)=>t[a]-t[e])).slice(0,10),a=e.map((e=>t[e]));reverseTopPairsChart&&(e=e.reverse(),a=a.reverse());const n=document.getElementById("topPairsChart"),r=Math.max(400,25*e.length);n.style.height=r+"px";const o=n.getContext("2d");charts.topPairsChart=new Chart(o,{type:"bar",data:{labels:e,datasets:[{label:"Số Ứng Viên",data:a,backgroundColor:getChartColors(e.length),borderRadius:5}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{beginAtZero:!0},y:{ticks:{font:{size:10}}}}}})}function drawAgeChart(){const t={};allData.forEach((e=>{const a=e["Ngày sinh"];if(a){const e=a.split("/");if(3===e.length){const a=parseInt(e[2]);a>0&&(t[a]=(t[a]||0)+1)}}}));let e=Object.keys(t).map((t=>parseInt(t))).sort(((t,e)=>t-e)),a=e.map((e=>t[e]));reverseAgeChart&&(e=e.reverse(),a=a.reverse());const n=document.getElementById("ageChart"),r=Math.max(400,25*e.length);n.style.height=r+"px";const o=n.getContext("2d");charts.ageChart=new Chart(o,{type:"bar",data:{labels:e.map((t=>"Năm "+t)),datasets:[{label:"Số Ứng Viên",data:a,backgroundColor:getChartColors(e.length),borderRadius:5}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{ticks:{font:{size:11}}},y:{beginAtZero:!0}}}})}function drawNoteChart(){const t=allData.filter((t=>t["Ghi chú"]&&t["Ghi chú"].trim())).length,e=allData.length-t,a=document.getElementById("noteChart").getContext("2d");charts.noteChart=new Chart(a,{type:"doughnut",data:{labels:["Có Ghi Chú","Không Ghi Chú"],datasets:[{data:[t,e],backgroundColor:["#4BC0C0","#FF6384"],borderWidth:2,borderColor:"#fff"}]},options:{responsive:!0,plugins:{legend:{position:"bottom"},tooltip:{callbacks:{label:function(a){const n=t+e,r=(a.parsed/n*100).toFixed(1);return a.label+": "+a.parsed+" ("+r+"%)"}}}}}})}function normalizeCCCD(t){if(!t)return"";return t.toString().trim().padStart(12,"0")}function search(){currentPage=1;const t=document.getElementById("searchInput").value.toLowerCase().trim(),e=document.getElementById("positionFilter").value,a=document.getElementById("nv1Filter").value,n=document.getElementById("nv2Filter").value,r=document.getElementById("genderFilter").value;filteredData=allData.filter((o=>{const s=o["Họ tên"].toLowerCase().includes(t);let i=!1;if(t.length>0){const e=normalizeCCCD(o["Số CCCD"]),a=normalizeCCCD(t);if(i=e.includes(a),!i&&a.startsWith("0")){const t=a.replace(/^0+/,"");i=e.replace(/^0+/,"").includes(t)}}const l=!e||o["Vị trí dự tuyển"]===e,d=!a||o["Tên trường NV1"]===a,h=!n||o["Tên Trường NV2"]===n,c=!r||o["Giới tính"]===r;return(s||i)&&l&&d&&h&&c})),updateStats(),displayTable()}function displayTable(){const t=document.getElementById("tableBody");if(t.innerHTML="",0===filteredData.length)return t.innerHTML='<tr>                    <td colspan="9" class="no-data">Không có dữ liệu phù hợp</td></tr>',document.getElementById("pagination").innerHTML="",void(document.getElementById("infoText").textContent="Không tìm thấy ứng viên nào.");const e=Math.ceil(filteredData.length/itemsPerPage),a=(currentPage-1)*itemsPerPage,n=a+itemsPerPage;filteredData.slice(a,n).forEach((e=>{const a=t.insertRow(),n="Nữ"===e["Giới tính"]?'<span class="badge badge-female">Nữ</span>':'<span class="badge badge-male">Nam</span>';let r=normalizeCCCD(e["Số CCCD"]);a.innerHTML=`\n                    <td data-label="STT">${e.STT}</td>\n                    <td data-label="Họ Tên"><strong>${e["Họ tên"]}</strong><span class="cccd-text">(${r})</span></td>\n                    <td data-label="Vị Trí">${e["Vị trí dự tuyển"]}</td>\n                    <td data-label="Giới Tính">${n}</td>\n                    <td data-label="Ngày Sinh">${e["Ngày sinh"]}</td>\n                    <td data-label="Chuyên Ngành">${e["Chuyên ngành đào tạo"]}</td>\n                    <td data-label="NV1">${e["Tên trường NV1"]}</td>\n                    <td data-label="NV2">${e["Tên Trường NV2"]}</td>\n                    <td data-label="Ghi Chú" title="${e["Ghi chú"]}">${e["Ghi chú"]?"✓":"-"}</td>\n                `})),document.getElementById("infoText").textContent=`Hiển thị ${a+1} - ${Math.min(n,filteredData.length)} trong ${filteredData.length} kết quả`,displayPagination(e)}function displayPagination(t){const e=document.getElementById("pagination");if(e.innerHTML="",t<=1)return;const a=document.createElement("button");a.textContent="← Trước",a.disabled=1===currentPage,a.onclick=()=>{currentPage>1&&(currentPage--,displayTable(),window.scrollTo({top:0,behavior:"smooth"}))},e.appendChild(a);const n=document.createElement("span");n.style.margin="0 20px",n.textContent=`${currentPage} / ${t}`,e.appendChild(n);const r=document.createElement("button");r.textContent="Sau →",r.disabled=currentPage===t,r.onclick=()=>{currentPage<t&&(currentPage++,displayTable(),window.scrollTo({top:0,behavior:"smooth"}))},e.appendChild(r)}document.getElementById("searchInput").addEventListener("keypress",(function(t){"Enter"===t.key&&search()})),window.addEventListener("DOMContentLoaded",init);